{% extends "base.html" %}
{% block title %}å‚·å®³ãƒ¬ãƒãƒ¼ãƒˆ{% endblock %}

{% block content %}
<h2 class="mb-4">ğŸ“Š å‚·å®³åˆ†æãƒ¬ãƒãƒ¼ãƒˆ</h2>

<div class="row">
    <div class="col-md-4">
        <div class="card mb-4 shadow-sm">
            <div class="card-header bg-primary text-white">Time Loss åŒºåˆ†</div>
            <div class="card-body">
                <ul class="list-group list-group-flush">
                {% for item in tl_counts %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        {{ item.time_loss_category }}
                        <span class="badge bg-primary rounded-pill">{{ item.count }}</span>
                    </li>
                {% endfor %}
                </ul>
            </div>
        </div>
    </div>
    
    <div class="col-md-8">
        <div class="card mb-4 shadow-sm">
            <div class="card-header bg-dark text-white">å‚·å®³éƒ¨ä½åˆ¥ ç™ºç”Ÿä»¶æ•° (Time Lossã‚±ãƒ¼ã‚¹)</div>
            <div class="card-body">
                <canvas id="injurySiteChart" width="400" height="200"></canvas>
            </div>
        </div>
    </div>
</div>

<div class="card shadow-sm">
    <div class="card-header">è©³ç´°é›†è¨ˆãƒ‡ãƒ¼ã‚¿</div>
    <div class="card-body overflow-auto" style="max-height: 400px;">
        {% for cat, items in grouped_data.items() %}
            <h6 class="mt-3 text-primary">{{ cat }} ({{ items|length }} ä»¶)</h6>
            <table class="table table-sm table-bordered">
                <thead class="table-light">
                    <tr><th>éƒ¨ä½</th><th>æå‚·ã‚¿ã‚¤ãƒ—</th><th>ä»¶æ•°</th></tr>
                </thead>
                <tbody>
                    {% for item in items %}
                    <tr><td>{{ item.injury_site }}</td><td>{{ item.injury_type }}</td><td>{{ item.count }}</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        {% endfor %}
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById('injurySiteChart').getContext('2d');
    new Chart(ctx, {
        type: 'bar', // æ¨ªæ£’ã‚°ãƒ©ãƒ•ã«ã™ã‚‹ã«ã¯ indexAxis: 'y'
        data: {
            labels: {{ chart_labels|safe }},
            datasets: [{
                label: 'è² å‚·ä»¶æ•°',
                data: {{ chart_values|safe }},
                backgroundColor: 'rgba(54, 162, 235, 0.6)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1
            }]
        },
        options: {
            indexAxis: 'y',
            scales: { x: { beginAtZero: true, ticks: { stepSize: 1 } } }
        }
    });
</script>
{% endblock %}